(function($){"use strict";var Page=React.createClass({displayName:"Page",statics:{getAllItems:function(successHandler){$.ajax({url:"/items/",type:"get",data:{category:Page.urlVars.category,hall:Page.urlVars.hall},success:function(response){successHandler(response)}.bind(this),fail:function(){console.log(arguments)}})},getItems:function(parameter,successHandler){var categories=[];for(var d in parameter.selectedCategories)categories.push(parameter.selectedCategories[d].id);$.ajax({url:"/items/",type:"get",data:{hall:parameter.selectedHall?parameter.selectedHall.id:null,categories:categories.join(",")},success:function(response){successHandler(response)},fail:function(){console.log(arguments)},complete:null})},urlVars:function(){var vars=[],max=0,hash="",array="",url=window.location.search;hash=url.slice(1).split("&"),max=hash.length;for(var i=0;max>i;i++)array=hash[i].split("="),vars.push(array[0]),vars[array[0]]=array[1];return vars}()},getInitialState:function(){return{items:[],categories:[],halls:[],selectedHall:null,selectedCategories:[],editorData:{},belongHallIds:[],editorVisible:!1}},componentDidMount:function(){Page.getItems({},function(response){this.setState({items:response})}.bind(this))},handleAddClick:function(){var belongHallIds=this.state.halls.map(function(hall){return hall.id});this.setState({editorVisible:!0,editorData:{},belongHallIds:belongHallIds})},handleItemEditClick:function(e){$.ajax({url:"/items/"+e.data.id+"/belong-hall-ids",type:"get",success:function(data){this.setState({editorVisible:!0,editorData:e.data,belongHallIds:data})}.bind(this),fail:function(){console.log(arguments)}})},handleItemRemoveClick:function(e){if(!confirm("本当に削除しますか？"))return this.setState({editorVisible:!1}),void 0;var removeTarget,newItems=[];this.state.items.forEach(function(item){e.data.id!==item.id?newItems.push(item):removeTarget=item}),$.ajax({url:"/items/"+removeTarget.id+"/remove",type:"post",fail:function(){console.log(arguments)},complete:function(){this.setState({items:newItems,editorVisible:!1})}.bind(this)})},handleEditorCloseClick:function(){this.setState({editorData:{},editorVisible:!1})},handleInsert:function(){Page.getItems(this.state,function(response){this.setState({items:response,editorData:{},editorVisible:!1})}.bind(this))},handleUpdate:function(){Page.getItems(this.state,function(response){this.setState({items:response,editorData:{},editorVisible:!1})}.bind(this))},handleFilter:function(e){console.log(e),Page.getItems(e,function(response){this.setState({items:response,editorData:{},editorVisible:!1,selectedHall:e.selectedHall,selectedCategories:e.selectedCategories})}.bind(this))},handleLoadCategories:function(e){this.setState({categories:e.data})},handleLoadHalls:function(e){this.setState({halls:e.data})},render:function(){var selectedCategories=[];for(var p in this.state.selectedCategories)selectedCategories.push(this.state.selectedCategories[p].name);var selectedHall=this.state.selectedHall?"会場："+this.state.selectedHall.name:"";return React.createElement("div",{className:"Page container"},React.createElement(Menu,{editable:!0,onFilter:this.handleFilter,onLoadCategories:this.handleLoadCategories,onLoadHalls:this.handleLoadHalls}),React.createElement("div",{className:"status"},"フィルタ:",React.createElement("span",{className:"selected-hall"},selectedHall),React.createElement("span",{className:"selected-categories"},selectedCategories.join(","))),React.createElement(ItemList,{items:this.state.items,editable:!0,onAddClick:this.handleAddClick,onItemEditClick:this.handleItemEditClick,onItemRemoveClick:this.handleItemRemoveClick}),React.createElement(ItemEditor,{data:this.state.editorData,visible:this.state.editorVisible,categories:this.state.categories,halls:this.state.halls,belongHallIds:this.state.belongHallIds,onCloseClick:this.handleEditorCloseClick,onInsert:this.handleInsert,onUpdate:this.handleUpdate}))}});React.render(React.createElement(Page,null),document.getElementById("page"))})(jQuery);